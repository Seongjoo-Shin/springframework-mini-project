<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.MypageDao">
	
	<resultMap id="userMap" type="user">
	    <result property="userId" column="user_id"/>
	    <result property="userPassword" column="user_password"/>
	    <result property="userEmail" column="user_email"/>
	    <result property="userName" column="user_name"/>
	    <result property="userPhone" column="user_phone"/>
	    <result property="userNickname" column="user_nickname"/>
	    <result property="userRole" column="user_role"/>
	    <result property="userEnabled" column="user_enabled"/>
	    <result property="userJoinDate" column="user_joindate"/>
	</resultMap>
	
	<resultMap id="freeboardMap" type="freeboard">
	    <result property="freeNo" column="free_no"/>
	    <result property="freeTitle" column="free_title"/>
	    <result property="freeContent" column="free_content"/>
	    <result property="freeWriter" column="freE_writer"/>
	    <result property="freeRegistDate" column="free_regist_date"/>
	    <result property="freeModifyDate" column="free_modify_date"/>
	    <result property="freeUseYN" column="free_use_YN"/>
	    <result property="freeHitCount" column="free_hit_count"/>
	</resultMap>
	
	<resultMap id="marketboardMap" type="marketboard">
	    <result property="marketNo" column="market_no"/>
	    <result property="marketTitle" column="market_title"/>
	    <result property="marketContent" column="market_content"/>
	    <result property="marketWriter" column="market_writer"/>
	    <result property="marketCategory" column="market_category"/>
	    <result property="marketRegistDate" column="market_regist_date"/>
	    <result property="marketModifyDate" column="market_modify_date"/>
	    <result property="marketUseYN" column="market_use_yn"/>
	    <result property="marketHitCount" column="market_hit_count"/>
	    <result property="marketPrice" column="market_price"/>
	    <result property="marketLikeCount" column="market_like_count"/>
	</resultMap>
	
	<resultMap id="buildingMap" type="building">
	    <result property="buildingNo" column="building_no"/>
	    <result property="buildingName" column="building_name"/>
	    <result property="buildingAddr" column="building_addr"/>
	    <result property="buildingAddrDetail" column="building_addr_detail"/>
	    <result property="buildingLatitude" column="building_latitude"/>
	    <result property="buildingLongitude" column="building_longitude"/>
	    <result property="buildingTradeInfo" column="building_trade_info"/>
	    <result property="buildingTakeoverPrice" column="building_takeover_price"/>
	    <result property="buildingDepositPrice" column="building_deposit_price"/>
	    <result property="buildingMonthRent" column="building_month_rent"/>
	    <result property="buildingPrice" column="building_price"/>
	    <result property="buildingAvailableDate" column="building_available_date"/>
	    <result property="buildingDetailContent" column="building_detail_content"/>
	    <result property="buildingUseYN" column="building_use_yn"/>
	    <result property="buildingWriter" column="building_writer"/>
	    <result property="buildingSupplyArea" column="building_supply_area"/>
	    <result property="buildingDedicatedArea" column="building_dedicated_area"/>
	    <result property="buildingTotalFloor" column="building_total_floor"/>
	    <result property="buildingFloor" column="building_floor"/>
	    <result property="buildingOption" column="building_option"/>
	</resultMap>
	
	<resultMap id="messageMap" type="message">
	    <result property="messageNo" column="message_no"/>
	    <result property="messageTitle" column="message_title"/>
	    <result property="messageContent" column="message_content"/>
	    <result property="messageDate" column="message_date"/>
	    <result property="messageSender" column="message_sender"/>
	    <result property="messageReceiver" column="message_receiver"/>
	    <result property="messageReplyYN" column="message_reply_yn"/>
	</resultMap>
	
	<select id="selectUser" resultMap="userMap" parameterType="String">
		SELECT 
			* 
		FROM
			users 
		WHERE 
			user_id = #{userId}
	</select>
	
	<!-- 유저 비밀번호 검색 -->
	<select id="selectPassword" resultMap="userMap">
		SELET 
			user_password 
		FROM
			users 
		WHERE 
			user_id = #{userId}
	</select>
	
	<!-- 유저 비밀번호 수정 -->
	<update id="updatePassword" parameterType="user">
		UPDATE 
			users 
		SET 
			user_password = #{userPassword} 
		WHERE 
			user_id = #{userId}
	</update>
	
	<!-- 유저 탈퇴 -->
	<update id="userWithdrawal" parameterType="user">
		update 
			users set user_enabled = 0 
		where user_id = #{userId}
	</update>
	
	<!--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 작성글 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-->
	<!-- 자유게시판 -->
	<select id="selectAllFreeBoard" resultType="Integer" parameterType="String">
		SELECT 
			count(*) 
		FROM 
			freeboards 
		WHERE
			free_writer = #{userId} and free_use_yn = 1
	</select>
	
	<select id="selectFreeBoardList" parameterType="pager" resultMap="freeboardMap">
		<![CDATA[
		SELECT rnum, free_no, free_title, free_writer, free_regist_date, free_modify_date
		FROM (
		  SELECT ROWNUM as rnum, free_no, free_title, free_writer, free_regist_date, free_modify_date
		  FROM (
		    SELECT free_no, free_title, free_writer, free_regist_date, free_modify_date
		    FROM freeboards
		    WHERE free_writer = #{userId} and free_use_yn = 1
		    ORDER BY free_no desc
		  )
		  WHERE ROWNUM <= #{endRowNo}
		)
		WHERE rnum >= #{startRowNo}
		]]>
	</select>

	
	<update id="deleteYnMyPosting" parameterType="Integer">
		UPDATE
		    freeboards   
		SET 
		    free_use_yn = 0   
		WHERE    
			free_no = #{freeNo}
	</update>	
	
	<!-- 거래게시판 -->
	<select id="selectAllMarketBoard" resultType="Integer" parameterType="String">
		SELECT 
			count(*) 
		FROM 
			marketboards 
		WHERE
			market_writer = #{userId} and market_use_yn = 1
	</select>
	
	<select id="selectMarketBoardList" parameterType="pager" resultMap="marketboardMap">
		<![CDATA[
		SELECT rnum, market_no, market_title, market_content, market_writer, market_file_seq, market_category, market_regist_date, market_modify_date, market_use_yn, market_hit_count, market_price, market_like_count
		FROM (
		  SELECT ROWNUM as rnum, market_no, market_title, market_content, market_writer, market_file_seq, market_category, market_regist_date, market_modify_date, market_use_yn, market_hit_count, market_price, market_like_count
		  FROM (
		    SELECT market_no, market_title, market_content, market_writer, market_file_seq, market_category, market_regist_date, market_modify_date, market_use_yn, market_hit_count, market_price, market_like_count
		    FROM marketboards
		    WHERE market_writer = #{userId} and market_use_yn = 1
		    ORDER BY market_no desc
		  )
		  WHERE ROWNUM <= #{endRowNo}
		)
		WHERE rnum >= #{startRowNo}
		]]>
	</select>
	
	<update id="deleteYnMyMarket" parameterType="Integer">
		UPDATE
		    marketboards   
		SET 
		    MARKET_USE_YN = 0   
		WHERE    
			market_no = #{marketNo}
	</update>
	
	<!-- 인수매물 -->
	<select id="selectAllBuilding" resultType="Integer" parameterType="String">
		SELECT 
			count(*) 
		FROM 
			buildings 
		WHERE
			building_writer = #{userId} and building_use_yn = 1
	</select>
	
	<select id="selectBuildingList" parameterType="pager" resultMap="buildingMap">
		<![CDATA[
		SELECT rnum, building_no, building_name, building_addr, building_addr_detail, building_latitude, building_longitude, building_trade_info, building_takeover_price, building_deposit_price, building_month_rent, building_price, building_available_date, building_detail_content, building_use_yn, building_writer, building_supply_area, building_dedicated_area, building_total_floor, building_floor, building_option, building_regist_date
		FROM (
		  SELECT ROWNUM as rnum, building_no, building_name, building_addr, building_addr_detail, building_latitude, building_longitude, building_trade_info, building_takeover_price, building_deposit_price, building_month_rent, building_price, building_available_date, building_detail_content, building_use_yn, building_writer, building_supply_area, building_dedicated_area, building_total_floor, building_floor, building_option, building_regist_date
		  FROM (
		    SELECT building_no, building_name, building_addr, building_addr_detail, building_latitude, building_longitude, building_trade_info, building_takeover_price, building_deposit_price, building_month_rent, building_price, building_available_date, building_detail_content, building_use_yn, building_writer, building_supply_area, building_dedicated_area, building_total_floor, building_floor, building_option, building_regist_date
		    FROM buildings
		    WHERE building_writer = #{userId} and building_use_yn = 1
		    ORDER BY building_no desc
		  )
		  WHERE ROWNUM <= #{endRowNo}
		)
		WHERE rnum >= #{startRowNo}
		]]>
	</select>

	
	<update id="deleteYnMyBuilding" parameterType="Integer">
		UPDATE
		    buildings   
		SET 
		    building_use_yn = 0   
		WHERE    
			building_no = #{buildingNo}
	</update>
	
	<!--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 쪽지함 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-->
	<select id="selectReceiveMessageList" parameterType="pager" resultMap="messageMap">
		<![CDATA[
		SELECT rnum, message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		FROM (
		  SELECT ROWNUM as rnum, message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		  FROM (
		    SELECT message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		    FROM messages
		    WHERE message_receiver = #{userId}
		    ORDER BY message_no desc
		  )
		  WHERE ROWNUM <= #{endRowNo}
		)
		WHERE rnum >= #{startRowNo}
		]]>
	</select>
	
	<select id="selectSendMessageList" parameterType="pager" resultMap="messageMap">
		<![CDATA[
		SELECT rnum, message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		FROM (
		  SELECT ROWNUM as rnum, message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		  FROM (
		    SELECT message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		    FROM messages
		    WHERE message_sender = #{userId}
		    ORDER BY message_no desc
		  )
		  WHERE ROWNUM <= #{endRowNo}
		)
		WHERE rnum >= #{startRowNo}
		]]>
	</select>
	
	<select id="selectReceiveMessageAll" resultType="Integer" parameterType="String">
		SELECT 
			count(*) 
		FROM 
			messages 
		WHERE
			message_receiver = #{userId}
	</select>
	
	<select id="selectSendMessageAll" resultType="Integer" parameterType="String">
		SELECT 
			count(*) 
		FROM 
			messages 
		WHERE
			message_sender = #{userId}
	</select>
	
	<delete id="deleteMyMessage" parameterType="Integer">
		DELETE FROM messages 
		WHERE message_no = #{messageNo}
	</delete>
	
	<select id="selectMessageByNo" parameterType="Integer" resultType="message">
		SELECT
			message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		FROM 
			messages
		WHERE
			message_no = #{messageNo}
	</select>
	
	<insert id="insertMessage" parameterType="message">
		INSERT INTO 
			messages
		VALUES (
			messages_seq.nextval, 
			#{messageTitle}, 
			#{messageContent}, 
			sysdate, 
			#{messageSender}, 
			#{messageReceiver}, 
			0
		)
	</insert>
	
	<update id="updateReplyYN" parameterType="Integer">
		UPDATE
		    messages   
		SET 
		    message_reply_yn = 1   
		WHERE    
			message_no = #{messageNo}
	</update>
	
	<!--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-->
</mapper>