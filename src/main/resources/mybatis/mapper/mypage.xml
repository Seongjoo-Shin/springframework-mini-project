<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.MypageDao">
	
	<resultMap id="userMap" type="user">
	    <result property="userId" column="user_id"/>
	    <result property="userPassword" column="user_password"/>
	    <result property="userEmail" column="user_email"/>
	    <result property="userName" column="user_name"/>
	    <result property="userPhone" column="user_phone"/>
	    <result property="userNickname" column="user_nickname"/>
	    <result property="userRole" column="user_role"/>
	    <result property="userEnabled" column="user_enabled"/>
	    <result property="userJoinDate" column="user_joindate"/>
	</resultMap>
	
	<resultMap id="freeboardMap" type="freeboard">
	    <result property="freeNo" column="free_no"/>
	    <result property="freeTitle" column="free_title"/>
	    <result property="freeContent" column="free_content"/>
	    <result property="freeWriter" column="freE_writer"/>
	    <result property="freeRegistDate" column="free_regist_date"/>
	    <result property="freeModifyDate" column="free_modify_date"/>
	    <result property="freeUseYN" column="free_use_YN"/>
	    <result property="freeHitCount" column="free_hit_count"/>
	</resultMap>
	
	<resultMap id="marketboardMap" type="marketboard">
	    <result property="marketNo" column="market_no"/>
	    <result property="marketTitle" column="market_title"/>
	    <result property="marketContent" column="market_content"/>
	    <result property="marketWriter" column="market_writer"/>
	    <result property="marketCategory" column="market_category"/>
	    <result property="marketRegistDate" column="market_regist_date"/>
	    <result property="marketModifyDate" column="market_modify_date"/>
	    <result property="marketHitCount" column="market_hit_count"/>
	    <result property="marketPrice" column="market_price"/>
	    <result property="marketLikeCount" column="market_like_count"/>
	</resultMap>
	
	<resultMap id="buildingMap" type="building">
	    <result property="buildingNo" column="building_no"/>
	    <result property="buildingName" column="building_name"/>
	    <result property="buildingAddr" column="building_addr"/>
	    <result property="buildingAddrDetail" column="building_addr_detail"/>
	    <result property="buildingLatitude" column="building_latitude"/>
	    <result property="buildingLongitude" column="building_longitude"/>
	    <result property="buildingTradeInfo" column="building_trade_info"/>
	    <result property="buildingTakeoverPrice" column="building_takeover_price"/>
	    <result property="buildingDepositPrice" column="building_deposit_price"/>
	    <result property="buildingMonthRent" column="building_month_rent"/>
	    <result property="buildingPrice" column="building_price"/>
	    <result property="buildingAvailableDate" column="building_available_date"/>
	    <result property="buildingDetailContent" column="building_detail_content"/>
	    <result property="buildingUseYN" column="building_use_yn"/>
	    <result property="buildingWriter" column="building_writer"/>
	    <result property="buildingSupplyArea" column="building_supply_area"/>
	    <result property="buildingDedicatedArea" column="building_dedicated_area"/>
	    <result property="buildingTotalFloor" column="building_total_floor"/>
	    <result property="buildingFloor" column="building_floor"/>
	    <result property="buildingOption" column="building_option"/>
	</resultMap>
	
	<resultMap id="messageMap" type="message">
	    <result property="messageNo" column="message_no"/>
	    <result property="messageTitle" column="message_title"/>
	    <result property="messageContent" column="message_content"/>
	    <result property="messageDate" column="message_date"/>
	    <result property="messageSender" column="message_sender"/>
	    <result property="messageReceiver" column="message_receiver"/>
	    <result property="messageReplyYN" column="message_reply_yn"/>
	</resultMap>
	
	<select id="selectUser" resultMap="userMap" parameterType="String">
		SELECT 
			* 
		FROM
			users 
		WHERE 
			user_id = #{userId}
	</select>
	
	<!-- 유저 비밀번호 검색 -->
	<select id="selectPassword" resultMap="userMap">
		SELET 
			user_password 
		FROM
			users 
		WHERE 
			user_id = #{userId}
	</select>
	
	<!-- 유저 비밀번호 수정 -->
	<update id="updatePassword" parameterType="user">
		UPDATE 
			users 
		SET 
			user_password = #{userPassword} 
		WHERE 
			user_id = #{userId}
	</update>
	
	<!-- 유저 탈퇴 -->
	<update id="userWithdrawal" parameterType="user">
		update 
			users set user_enabled = 0 
		where user_id = #{userId}
	</update>
	
	<select id="selectFreeBoardList" parameterType="pager" resultMap="freeboardMap">
		<![CDATA[
		SELECT rnum, free_no, free_title, free_writer, free_regist_date, free_modify_date
		FROM (
		  SELECT ROWNUM as rnum, free_no, free_title, free_writer, free_regist_date, free_modify_date
		  FROM (
		    SELECT free_no, free_title, free_writer, free_regist_date, free_modify_date
		    FROM freeboards
		    WHERE free_writer = #{userId} and free_use_yn = 1
		    ORDER BY free_no desc
		  )
		  WHERE ROWNUM <= #{endRowNo}
		)
		WHERE rnum >= #{startRowNo}
		]]>
	</select>
	
	<select id="selectAllFreeBoard" resultType="Integer" parameterType="String">
		SELECT 
			count(*) 
		FROM 
			freeboards 
		WHERE
			free_writer = #{userId} and free_use_yn = 1
	</select>
	
	<update id="updateYnMyPosting" parameterType="Integer">
		UPDATE
		    freeboards   
		SET 
		    free_use_yn = 0   
		WHERE    
			free_no = #{freeNo}
	</update>	
	
	<select id="selectReceiveMessageList" parameterType="pager" resultMap="messageMap">
		<![CDATA[
		SELECT rnum, message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		FROM (
		  SELECT ROWNUM as rnum, message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		  FROM (
		    SELECT message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		    FROM messages
		    WHERE message_receiver = #{userId} and message_reply_yn = 1
		    ORDER BY message_no desc
		  )
		  WHERE ROWNUM <= #{endRowNo}
		)
		WHERE rnum >= #{startRowNo}
		]]>
	</select>
	
	<select id="selectSendMessageList" parameterType="pager" resultMap="messageMap">
		<![CDATA[
		SELECT rnum, message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		FROM (
		  SELECT ROWNUM as rnum, message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		  FROM (
		    SELECT message_no, message_title, message_content, message_date, message_sender, message_receiver, message_reply_yn
		    FROM messages
		    WHERE message_sender = #{userId} and message_reply_yn = 1
		    ORDER BY message_no desc
		  )
		  WHERE ROWNUM <= #{endRowNo}
		)
		WHERE rnum >= #{startRowNo}
		]]>
	</select>
	
	<select id="selectReceiveMessageAll" resultType="Integer" parameterType="String">
		SELECT 
			count(*) 
		FROM 
			messages 
		WHERE
			message_receiver = #{userId}
	</select>
	
	<select id="selectSendMessageAll" resultType="Integer" parameterType="String">
		SELECT 
			count(*) 
		FROM 
			messages 
		WHERE
			message_sender = #{userId}
	</select>
	
	<delete id="deleteMyMessage" parameterType="Integer">
		DELETE FROM messages 
		WHERE message_no = #{messageNo}
	</delete>
	
	<select id="selectMessageByNo" resultType="message" parameterType="Integer" >
		SELECT
			*
		FROM 
			messages
		WHERE
			message_no = #{messageNo}
	</select>
		
</mapper>